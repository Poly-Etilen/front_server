<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HIGH-FIVE BOOKS - 주문 상세</title>
    <style>
        :root {
            --color-primary: #007bff;
            --color-accent: #e9c46a;
            --color-dark-footer: #3e2723;
            --color-text-light: #666;
            --color-text-dark: #333;
            --color-border-light: #eee;
            --color-border: #ddd;
            --color-bg: #f9fafb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
            color: var(--color-text-dark);
            line-height: 1.6;
            background-color: var(--color-bg);
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        a:hover {
            color: var(--color-accent);
        }

        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
        }

        .container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
        }

        /* 헤더 (기존 마이페이지와 동일 패턴) */
        #header {
            border-bottom: 3px solid var(--color-primary);
            padding: 6px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            background-color: #fff;
        }
        #header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }
        .logo .brand {
            font-size: 21px;
            font-weight: 900;
            color: #000080;
        }
        .gnb {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .gnb .search-box {
            display: flex;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            overflow: hidden;
            width: 360px;
        }
        .gnb .search-box input {
            flex-grow: 1;
            border: none;
            padding: 8px 15px;
            outline: none;
        }
        .gnb .search-box .search-btn {
            padding: 8px 15px;
            background-color: var(--color-primary);
            color: white;
            white-space: nowrap;
        }
        .user-menu {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-left: auto;
        }
        .user-menu .user-link {
            display: flex;
            align-items: center;
            padding: 4px;
        }
        .user-menu .user-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            transition: opacity 0.2s ease;
        }
        .user-menu .user-link:hover .user-icon {
            opacity: 0.7;
        }

        /* 메인 레이아웃 */
        main {
            padding: 30px 0 40px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 18px;
            border-left: 5px solid var(--color-primary);
            padding-left: 10px;
        }

        .order-detail-wrap {
            background: #fff;
            border-radius: 12px;
            border: 1px solid var(--color-border-light);
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            padding: 22px 26px 26px;
        }

        .order-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 16px;
        }
        .order-top-left {
            font-size: 14px;
        }
        .order-top-left .num {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 3px;
        }
        .order-top-left .date {
            color: #888;
        }
        .order-top-right {
            text-align: right;
            font-size: 13px;
        }
        .badge-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .badge-status.shipping {
            background: #e3f2fd;
            color: #1565c0;
        }
        .badge-status.completed {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .section-block {
            margin-top: 18px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border-light);
        }
        .section-block:first-of-type {
            border-top: 1px solid var(--color-border-light);
        }
        .section-title-sm {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        /* 주문 상품 테이블 */
        .order-items-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .order-items-table th,
        .order-items-table td {
            padding: 10px 6px;
            border-top: 1px solid var(--color-border-light);
        }
        .order-items-table th {
            background: #fafafa;
            font-weight: 600;
            text-align: left;
            color: var(--color-text-light);
        }
        .order-items-table td.price,
        .order-items-table td.qty,
        .order-items-table td.sum {
            text-align: right;
            white-space: nowrap;
        }
        .item-title {
            font-weight: 600;
        }
        .item-meta {
            font-size: 12px;
            color: var(--color-text-light);
        }

        /* 배송지 정보/결제 정보 */
        .info-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
            font-size: 13px;
        }
        .info-card {
            border: 1px solid var(--color-border-light);
            border-radius: 8px;
            padding: 12px 14px;
            background: #fafafa;
        }
        .info-row {
            display: flex;
            padding: 4px 0;
        }
        .info-row label {
            width: 80px;
            color: var(--color-text-light);
        }
        .info-row div {
            flex: 1;
            font-weight: 500;
        }
        .addr-extra {
            margin-top: 4px;
            font-size: 12px;
            color: #999;
        }

        /* 결제 요약 */
        .pay-summary {
            font-size: 13px;
        }
        .pay-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }
        .pay-row.total {
            padding-top: 8px;
            margin-top: 6px;
            border-top: 1px solid var(--color-border);
            font-weight: 700;
        }

        /* 하단 버튼 */
        .page-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 9px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid transparent;
            background: #fff;
        }
        .btn-outline {
            border-color: var(--color-border);
            color: var(--color-text-dark);
        }
        .btn-outline:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }
        .btn-primary {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: #fff;
        }
        .btn-primary:hover {
            background: #0056b3;
            border-color: #0056b3;
        }
        .btn-primary[disabled] {
            background: #ccc;
            border-color: #ccc;
            cursor: default;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<header id="header" role="banner">
    <div class="container">
        <a href="/mypage" class="logo">
            <img src="../img/logo.png" alt="HIGH-FIVE 로고" />
            <div class="brand">HIGH-FIVE BOOKS</div>
        </a>

        <nav class="gnb" aria-label="주요 메뉴">
            <div class="search-box" role="search">
                <input type="search"
                       placeholder="검색어를 입력하세요"
                       aria-label="통합 검색" />
                <form method="get" action="/search">
                    <button class="search-btn" type="submit">검색</button>
                </form>
            </div>
        </nav>

        <div class="user-menu">
            <a class="user-link" href="/coupon">
                <img src="../img/icon-coupon.png" alt="쿠폰" class="user-icon" />
            </a>
            <a class="user-link" href="/mypage">
                <img src="../img/icon-mypage.png" alt="마이페이지" class="user-icon" />
            </a>
            <a class="user-link" href="/cart">
                <img src="../img/icon-cart.png" alt="장바구니" class="user-icon" />
            </a>
        </div>
    </div>
</header>

<main>
    <div class="container">
        <h1 class="page-title">주문 상세</h1>

        <section class="order-detail-wrap">

            <!-- 상단 주문 정보 -->
            <div class="order-top">
                <div class="order-top-left">
                    <div class="num">
                        주문번호
                        <span th:text="${order.orderNumber}">2025-11-000123</span>
                    </div>
                    <div class="date">
                        주문일자
                        <span th:text="${order.orderDate}">2025-11-25</span>
                    </div>
                </div>
                <div class="order-top-right">
                    <span class="badge-status shipping"
                          th:classappend="${order.status == 'COMPLETED'} ? ' completed' : ' shipping'">
                        <span th:text="${order.statusName}">배송완료</span>
                    </span><br/>
                    <span style="color:#999; font-size:12px;"
                          th:text="${order.confirmMessage}">
                        구매확정 가능 기간 D-3
                    </span>
                </div>
            </div>

            <!-- 주문 상품 정보 -->
            <div class="section-block">
                <div class="section-title-sm">주문 상품</div>
                <table class="order-items-table">
                    <thead>
                    <tr>
                        <th style="width: 50%;">상품 정보</th>
                        <th style="width: 10%;">수량</th>
                        <th style="width: 20%;">상품금액</th>
                        <th style="width: 20%;">주문금액</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- th:each="item : ${order.items}" -->
                    <tr>
                        <td>
                            <div class="item-title"
                                 th:text="${item.title}">
                                어린 왕자 (개정판)
                            </div>
                            <div class="item-meta"
                                 th:text="${item.optionText}">
                                양장 · 사은품: 북마크 포함
                            </div>
                        </td>
                        <td class="qty" th:text="${item.quantity}">1</td>
                        <td class="price" th:text="${item.priceFormatted}">39,800원</td>
                        <td class="sum" th:text="${item.totalPriceFormatted}">39,800원</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 배송지 / 결제 정보 -->
            <div class="section-block">
                <div class="section-title-sm">배송 및 결제 정보</div>

                <div class="info-grid">
                    <!-- 배송지 -->
                    <div class="info-card">
                        <div style="font-weight:700; margin-bottom:8px;">배송지 정보</div>
                        <div class="info-row">
                            <label>수령인</label>
                            <div th:text="${order.receiverName}">홍길동</div>
                        </div>
                        <div class="info-row">
                            <label>연락처</label>
                            <div th:text="${order.receiverPhone}">010-1234-5678</div>
                        </div>
                        <div class="info-row">
                            <label>주소</label>
                            <div>
                                <span th:text="${order.address}">서울특별시 마포구 홍익로 12</span>
                                <div class="addr-extra"
                                     th:text="${order.addressDetail}">
                                    101동 1001호 (문 앞 보관)
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <label>요청사항</label>
                            <div th:text="${order.deliveryRequest}">
                                경비실에 맡겨 주세요.
                            </div>
                        </div>
                    </div>

                    <!-- 결제 정보 -->
                    <div class="info-card">
                        <div style="font-weight:700; margin-bottom:8px;">결제 정보</div>
                        <div class="pay-summary">
                            <div class="pay-row">
                                <span>상품금액</span>
                                <span th:text="${order.itemAmountFormatted}">39,800원</span>
                            </div>
                            <div class="pay-row">
                                <span>배송비</span>
                                <span th:text="${order.deliveryFeeFormatted}">+ 3,000원</span>
                            </div>
                            <div class="pay-row">
                                <span>쿠폰할인</span>
                                <span th:text="${order.couponDiscountFormatted}">- 5,000원</span>
                            </div>
                            <div class="pay-row">
                                <span>포인트 사용</span>
                                <span th:text="${order.pointUsedFormatted}">- 2,000원</span>
                            </div>
                            <div class="pay-row total">
                                <span>총 결제금액</span>
                                <span th:text="${order.totalPayAmountFormatted}">35,800원</span>
                            </div>
                            <div class="pay-row" style="margin-top:6px;">
                                <span>결제수단</span>
                                <span th:text="${order.payMethodName}">
                                    신용카드 (일시불)
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 하단 버튼 -->
            <div class="page-actions">
                <a href="/mypage#orders" class="btn btn-outline">
                    주문 목록으로
                </a>
                <button type="button"
                        class="btn btn-primary"
                        id="btn-confirm"
                        th:disabled="${order.confirmDisabled}">
                    구매확정
                </button>
            </div>
        </section>
    </div>
</main>

<script>
    // 프론트 단에서 한번 더 확인만 띄우고, 실제 처리는 백엔드 API 연동 예정
    const confirmBtn = document.getElementById("btn-confirm");
    if (confirmBtn) {
        confirmBtn.addEventListener("click", () => {
            if (confirmBtn.disabled) return;
            const ok = confirm("이 주문을 구매확정 처리하시겠습니까?");
            if (!ok) return;

            // TODO: fetch('/orders/{id}/confirm', { method: 'POST' ... }) 등으로 연동
            alert("구매확정 처리되었습니다. (백엔드 연동 시 실제 처리)");
            confirmBtn.disabled = true;
            confirmBtn.textContent = "구매확정 완료";
        });
    }
</script>
</body>
</html>
